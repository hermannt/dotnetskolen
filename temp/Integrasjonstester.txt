
Før vi begynner å implementere selve web-API-et skal vi skrive integrasjonstestene som skal verifisere at API-et oppfører seg slik som definert i OpenAPI-kontrakten. Måten vi gjør det på er å kjøre API-et vårt på en webserver som lever i minnet, og sende HTTP-forespørsler til denne webserveren. Ved å gjøre det slik kan vi automatisk teste API-et vårt uten å deploye det noe sted. Inspirasjonen til å sette opp dette er hentet fra denne artikkelen skrevet av Microsoft: [https://docs.microsoft.com/en-us/aspnet/core/test/integration-tests?view=aspnetcore-5.0](https://docs.microsoft.com/en-us/aspnet/core/test/integration-tests?view=aspnetcore-5.0)

#### Kort oppsummert

Endre `Project`-element i `Test.fsproj` og `Api.fsproj`

```xml
<Project Sdk="Microsoft.NET.Sdk.Web">
```

Legg til NuGet-pakke:

```bash
$ dotnet paket add Microsoft.AspNetCore.Mvc.Testing --project .\test\integration\NRK.Dotnetskolen.IntegrationTests.fsproj
...
```

Definer Startup

```f#

```

Legg til prosjektreferanse

```bash
$ dotnet add .\test\integration\NRK.Dotnetskolen.IntegrationTests.fsproj reference .\src\api\NRK.Dotnetskolen.Api.fsproj
...
```

`Program.fs`

```f#
open Microsoft.AspNetCore.Hosting
open Microsoft.Extensions.Hosting
open NRK.Dotnetskolen.Api.Startup

let exitCode = 0

let CreateHostBuilder args =
    Host.CreateDefaultBuilder(args)
        .ConfigureWebHostDefaults(fun webBuilder ->
            webBuilder.UseStartup<Startup>() |> ignore
        )

[<EntryPoint>]
let main args =
    CreateHostBuilder(args).Build().Run()

    exitCode
```
